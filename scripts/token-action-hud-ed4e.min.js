const e={ID:"token-action-hud-ed4e"},t={ID:"token-action-hud-core"},a="1.4",s={ability:"DND5E.Ability",check:"tokenActionHud.dnd5e.check",condition:"tokenActionHud.dnd5e.condition",effect:"DND5E.Effect",feature:"ITEM.TypeFeat",item:"tokenActionHud.dnd5e.item",save:"DND5E.ActionSave",skill:"tokenActionHud.dnd5e.skill",spell:"ITEM.TypeSpell",utility:"DND5E.ActionUtil"},o={bonus:"fas fa-plus",crew:"fas fa-users",day:"fas fa-hourglass-end",hour:"fas fa-hourglass-half",lair:"fas fa-home",minute:"fas fa-hourglass-start",legendary:"fas fas fa-dragon",reaction:"fas fa-bolt",special:"fas fa-star"},n="fas fa-circle-c",i="fas fa-sun",r="fas fa-circle-r",l={.5:"fas fa-adjust",1:"fas fa-check",2:"fas fa-check-double"},c={attributes:{id:"attributes",name:"earthdawn.a.attributes",type:"system"},other:{id:"other",name:"earthdawn.o.other",type:"system"},system:{id:"system",name:"tokenActionHud.ed4e.system",type:"system"},favorites:{id:"favorites",name:"tokenActionHud.ed4e.favorites",type:"system"}};let d=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{d=class Utils{static getSetting(a,s=null){let o=s??null;try{o=game.settings.get(e.ID,a)}catch{t.api.Logger.debug(`Setting '${a}' not found`)}return o}static async setSetting(a,s){try{s=await game.settings.set(e.ID,a,s),t.api.Logger.debug(`Setting '${a}' set to '${s}'`)}catch{t.api.Logger.debug(`Setting '${a}' not found`)}}}}));let h=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{h=class ActionHandler extends e.api.ActionHandler{i18n=game.i18n;actors=null;tokens=null;actorType=null;items=null;showGeneral=null;showFavorites=null;showTalents=null;showSkills=null;showMatrices=null;showInventory=null;showStatusToggle=null;showCombat=null;async buildSystemActions(t){if(this.actors=this.actor?[this.actor]:this.#e(),this.tokens=this.token?[this.token]:this.#t(),this.actorType=this.actor?.type,this.actor){let t=this.actor.items;t=e.api.Utils.sortItemsByName(t),this.items=t}this.showGeneral=d.getSetting("showGeneral"),this.showFavorites=d.getSetting("showFavorites"),this.showTalents=d.getSetting("showTalents"),this.showSkills=d.getSetting("showSkills"),this.showMatrices=d.getSetting("showMatrices"),this.showInventory=d.getSetting("showInventory"),this.showStatusToggle=d.getSetting("showStatusToggle"),this.showCombat=d.getSetting("showCombat"),this.actor&&await this.#a()}async#a(){this.#s(),this.#o()}#s(){const e="creature"===this.actor.type;let t=["earthdawn.d.dexterity","earthdawn.s.strength","earthdawn.t.toughness","earthdawn.p.perception","earthdawn.w.willpower","earthdawn.c.charisma"].map((e=>({id:null,name:this.i18n.localize(e),encodedValue:["attribute",this.token.id,e].join(this.delimiter),tooltip:this.i18n.format("tokenActionHud.ed4e.tooltips.attributeTest",{attribute:this.i18n.localize(e)})}))).filter((e=>!!e));this.addActions(t,{id:"attributes",type:"system"});let a=[{id:null,name:this.i18n.localize("earthdawn.r.recovery"),encodedValue:["recovery",this.token.id,"recovery"].join(this.delimiter),tooltip:this.i18n.localize("tokenActionHud.ed4e.tooltips.recoveryTest")}];e||a.push({id:null,name:this.i18n.localize("earthdawn.n.newDay"),encodedValue:["newday",this.token.id,"newday"].join(this.delimiter)},{id:null,name:this.i18n.localize("earthdawn.h.halfMagic"),encodedValue:["halfmagic",this.token.id,"halfmagic"].join(this.delimiter)});this.addActions(a,{id:"other",type:"system"});const s={"earthdawn.u.useKarma":"usekarma"};let o=["earthdawn.u.useKarma"].map((e=>({id:null,name:this.i18n.localize(e),encodedValue:["toggle",this.token.id,s[e]].join(this.delimiter),cssClass:"true"===this.actor.system.usekarma?"active":"toggle"}))).filter((e=>!!e)).sort(((e,t)=>e.name.localeCompare(t.name)));const n={id:"system",type:"system"};e||this.addActions(o,n)}#o(){if("creature"===this.actor.type)return;let e=Array.from(this.actor.items.values()).filter((e=>"true"===e.system.favorite)).map((e=>{try{let t=e.id,a=e.type.toLowerCase(),s=e.name;e.system.hasOwnProperty("ranks")&&(s+=" ("+e.system.ranks+")");let o=[a,this.token.id,t].join(this.delimiter);return{name:s,id:t,encodedValue:o}}catch(t){return t(e??"No item in favorites"),null}})).filter((e=>!!e)).sort(((e,t)=>e.name.localeCompare(t.name)));this.addActions(e,{id:"favorites",type:"system"})}#e(){const e=["pc","npc","creature"],t=canvas.tokens.controlled.filter((e=>e.actor)).map((e=>e.actor));return t.every((t=>e.includes(t.type)))?t:[]}#t(){const e=["pc","npc","creature"],t=canvas.tokens.controlled;return t.filter((e=>e.actor)).map((e=>e.actor)).every((t=>e.includes(t.type)))?t:[]}}}));let g=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{const t=c;Object.values(t).forEach((t=>{t.name=e.api.Utils.i18n(t.name),t.listName=`Group: ${e.api.Utils.i18n(t.name)}`}));const a=Object.values(t);g={layout:[{nestId:"general",id:"general",name:e.api.Utils.i18n("tokenActionHud.ed4e.general"),groups:[{...t.attributes,nestId:"general_attributes"},{...t.other,nestId:"general_other"},{...t.system,nestId:"general_system"}]},{nestId:"favorites",id:"favorites",name:e.api.Utils.i18n("tokenActionHud.ed4e.favorites"),groups:[{...t.favorites,nestId:"favorites_favorites"}]}],groups:a}}));let u=null;function register(t){game.settings.register(e.ID,"showGeneral",{name:"Show General",hint:"Display category for general rolls like Attributes, Half-Magic or Recovery",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showFavorites",{name:"Show Favorites",hint:"Display category for items marked as favorites",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showTalents",{name:"Show Talents",hint:"Display category for all talents",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showSkills",{name:"Show Skills",hint:"Display category for all skills",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showMatrices",{name:"Show Matrices",hint:"Display category for all spell matrices",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showInventory",{name:"Show Inventory",hint:"Display category for weapons and equipment",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showStatusToggle",{name:"Show Status Toggle",hint:"Display category for toggling system use and conditions",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}}),game.settings.register(e.ID,"showCombat",{name:"Show Combat",hint:"Display category for combat (Weapons, Matrices, Favorites, etc.",scope:"client",config:!0,type:Boolean,default:!0,onChange:e=>{t(e)}})}Hooks.once("tokenActionHudCoreApiReady",(async e=>{u=class RollHandler extends e.api.RollHandler{async doHandleActionEvent(e,t){console.log('TOKEN ACTION HUD: WE"RE HANDLING AN EVENT! IN THEORY... I MEAN... IT WORKS UP UNTIL HERE')}}}));let y=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{y=class SystemManager extends e.api.SystemManager{doGetCategoryManager(t){return new e.api.CategoryManager}doGetActionHandler(e){return new h(e)}getAvailableRollHandlers(){return{core:"Core Earthdawn 4th Edition"}}doGetRollHandler(e){let t;return t=new u,t}doRegisterSettings(e){register(e)}async doRegisterDefaultFlags(){return g}}})),Hooks.on("tokenActionHudCoreApiReady",(async()=>{const t=game.modules.get(e.ID);t.api={requiredCoreModuleVersion:"1.4",SystemManager:y},Hooks.call("tokenActionHudSystemReady",t)}));export{s as ACTION_TYPE,o as ACTIVATION_TYPE_ICON,h as ActionHandler,n as CONCENTRATION_ICON,t as CORE_MODULE,g as DEFAULTS,c as GROUP,e as MODULE,i as PREPARED_ICON,l as PROFICIENCY_LEVEL_ICON,a as REQUIRED_CORE_MODULE_VERSION,r as RITUAL_ICON,u as RollHandler,y as SystemManager,d as Utils,register};
